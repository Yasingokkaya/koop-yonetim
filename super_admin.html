<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Süper Admin</title>
    <style>
        body { font-family: sans-serif; padding: 50px; }
        input { display: block; margin: 10px 0; padding: 10px; width: 100%; max-width: 300px; }
        button { padding: 10px 20px; background: green; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>

    <h2>Müşteri Oluştur</h2>
    <input type="text" id="kurumAdi" placeholder="Kurum Adı">
    <input type="text" id="kurumID" placeholder="Kurum Kodu (boşluksuz)">
    <input type="email" id="email" placeholder="Email">
    <input type="text" id="password" placeholder="Şifre">
    <button onclick="musteriOlustur()">KAYDET</button>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
  apiKey: "AIzaSyAMTYZGCkVv1QausRJSyutrSUUvJ0mkqD4",
  authDomain: "koopplatform-dd9f8.firebaseapp.com",
  projectId: "koopplatform-dd9f8",
  storageBucket: "koopplatform-dd9f8.firebasestorage.app",
  messagingSenderId: "757328538678",
  appId: "1:757328538678:web:ffc9994b42025765b1fc97",
  measurementId: "G-R9K7G471FN"
};

    // Uygulamayı Başlat
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Fonksiyonu window'a (global alana) bağlıyoruz ki buton görebilsin
    window.musteriOlustur = async function() {
        console.log("Butona basıldı..."); 

        const kAdi = document.getElementById('kurumAdi').value;
        const kID = document.getElementById('kurumID').value;
        const mail = document.getElementById('email').value;
        const pass = document.getElementById('password').value;

        if(!kAdi || !kID || !mail || !pass) {
            alert("Boş alan bırakma!");
            return;
        }

        try {
            console.log("Kullanıcı oluşturuluyor...");
            const userCredential = await createUserWithEmailAndPassword(auth, mail, pass);
            const user = userCredential.user;

            console.log("Firestore'a yazılıyor...");
            await setDoc(doc(db, "users", user.uid), {
                email: mail,
                kurumAdi: kAdi,
                kurumID: kID,
                rol: "yonetici",
                kayitTarihi: new Date().toISOString()
            });

            alert("✅ BAŞARILI! Müşteri oluşturuldu.");
            location.reload(); 

        } catch (error) {
            console.error("HATA:", error);
            alert("Hata: " + error.code + " - " + error.message);
        }
    }
</script>

</body>
</html>